<ion-content fullscreen="true">
  <div class="modal-background">
    <img src="../../assets/background/flow.webp" />
  </div>
  <ion-grid class="main-content mt-0 pt-0 pb-0 mb-0">
    <ion-row>
      <ion-col size="12">
        <ion-header class="no-shadow m-0 p-0">
          <ion-toolbar>
            <ion-buttons slot="start">
              <ion-button fill="clear" (click)="dismiss()">
                <ion-icon name="arrow-back"></ion-icon>
              </ion-button>
            </ion-buttons>
            <ion-title>
              <!-- Less 1 because database starts at 1 and not 0 -->
              Inscription <span *ngIf="!isLoading">#{{ inscription.id - 1 }}</span>
            </ion-title>
          </ion-toolbar>
        </ion-header>
      </ion-col>
    </ion-row>
    <ion-row>
      <ion-col size="12" offset="0" class="mt-0 pt-0">
        <div class="p-4" *ngIf="isLoading">
          <div class="loading">
            <ion-progress-bar type="indeterminate"></ion-progress-bar>
            <p>
              Loading inscription...
            </p>
          </div>
        </div>
        <div class="aligned mt-0 pt-0" *ngIf="!isLoading">
          <ion-grid>
            <ion-row>
              <ion-col size="6" offset="3">
                <a href="/app/inscription/{{ inscription.transaction.hash }}" target="_blank" class="text-center">
                  <app-generic-preview [mime]="inscription.mime" [contentPath]="inscription.content_path"
                    [isExplicit]="inscription.is_explicit"></app-generic-preview>
                </a>
              </ion-col>
              <ion-col size="12" class="text-center">
                <div>
                  <h1 class="mt-0">{{ inscription.name }}</h1>
                  <p>{{ inscription.description || "No description provided" }}</p>
                </div>
                <div class="detail-item d-inline-block">
                  <a [routerLink]="['/app/wallet', inscription.marketplace_inscription_details[0].marketplace_listing.seller_address ]"
                    [queryParams]="{section: 'inscriptions'}" target="_blank">
                    <ion-chip>
                      <ion-avatar>
                        <img alt="Unknown avatar" src="../../assets/avatar.svg" />
                      </ion-avatar>
                      <ion-label
                        *ngIf="inscription.marketplace_inscription_details[0].marketplace_listing.seller_address == currentAddress">You</ion-label>
                      <ion-label
                        *ngIf="inscription.marketplace_inscription_details[0].marketplace_listing.seller_address != currentAddress">{{
                        inscription.marketplace_inscription_details[0].marketplace_listing.seller_address
                        | shortenAddress | async}}</ion-label>
                    </ion-chip>
                  </a>
                </div>
                <div class="text-center p-2 pt-0  d-inline-block">
                  <ion-button color="primary" fill="clear" href="/app/inscription/{{ inscription.transaction.hash }}"
                    target="_blank" *ngIf="!inscription.is_explicit">
                    View full details <ion-icon name="open-outline" class="ps-2"></ion-icon>
                  </ion-button>
                </div>
              </ion-col>
              <ion-col size="12">
                <ion-grid>
                  <ion-row class="break pt-2">
                    <ion-col>
                      <div class="marketplace-price pt-0 mt-0 text-center">
                        <ion-label class="value">{{
                          inscription.marketplace_inscription_details[0]?.marketplace_listing?.total | tokenDecimals:6}}
                          <span>ATOM</span></ion-label>
                        <ion-label class="label">Price</ion-label>
                      </div>
                    </ion-col>
                    <ion-col class="text-end">
                      <ion-button color="success" (click)="buy()"
                        *ngIf="inscription.marketplace_inscription_details[0]?.marketplace_listing?.seller_address != currentAddress">Buy
                        now</ion-button>
                      <ion-button color="warning" fill="outline" (click)="delist()"
                        *ngIf="inscription.marketplace_inscription_details[0]?.marketplace_listing?.seller_address == currentAddress">Cancel
                        listing</ion-button>
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </ion-col>
            </ion-row>
          </ion-grid>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>